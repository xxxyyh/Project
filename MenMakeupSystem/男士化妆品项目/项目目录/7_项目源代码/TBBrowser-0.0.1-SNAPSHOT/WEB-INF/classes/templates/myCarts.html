	<!DOCTYPE html>
	<html lang="en">
	<html xmlns:th="http:www.thymeleaf.org">
	<head>
	    <meta charset="UTF-8">
	    <title>我的购物车</title>
	    <link rel="stylesheet" th:href="@{/css/base.css}">
	    <link rel="stylesheet" th:href="@{/css/myCarts.css}">
	    <link rel="stylesheet" th:href="@{https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css}">
		<!--js开始-->
		<script th:src="@{https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js}"></script>
		<script th:src="@{https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js}"></script>
		<style type="text/css">
			#operation {
				position: fixed;
				top: 60%;
				right: 0;
			}
			#operation div {
				width: 50px;
				height: 80px;
				background-color: red;
				margin-top: 10px;
				text-align: center;
				padding: 20px 15px 0;
				color: white;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
	<!--头部开始-->
	<div class="header ">
		<div class="inner">
			<div class="left clearfix">
				<a th:href="@{/index.html}">
					<img th:src="@{/images/logo.png}" alt="">
				</a>
			</div>
			<div class="right">
				<ul class="clearfix">
					<li>
						<a th:href="@{/index.html}">首页</a>
					</li>
					<li>
						<a href="#">全部产品</a>
					</li>
					<li>
						<a href="#">专柜地址</a>
					</li>
					<li>
						<a href="#" style="margin-right: 50px">客服中心</a>
					</li>
					<li>
						<a href="#">订阅电子杂志</a>
					</li>
					<li>
						<a th:href="@{aboutUs.html}">我的购物车<span></span></a>
					</li>
					<li id="li-login">
						<a th:href="@{/login.html}">登录</a>
						<a th:href="@{/resiter.html}">注册</a>
						<!--<span th:text="${session.currentUser.useraccount}"></span>-->
					</li>
					<li class="dropdown">
						<a id="li-useraccount" class="dropdown-toggle" data-toggle="dropdown" >
							账号:<span id="useraccount"></span>
						</a>
						<img  id="li-usericon" class="dropdown-toggle" data-toggle="dropdown" style="width:45px;height:45px; border-radius: 100%;">
						<ul class="dropdown-menu" aria-labelledby="dropdownScale">
							<li class="scale-item" ><a th:href="@{/personalDetails.html}"><span class="fa fa-edit"></span>个人信息</a></li>
							<li class="scale-item" ><a th:href="@{/myOrder.html}"><span class="fa fa-edit" ></span>我的订单</a></li>
							<li class="scale-item" ><a id="logout">退出系统</a></li>
						</ul>
					</li>
				</ul>
				</li>
				</ul>
			</div>
		</div>
	</div>
	<!--头部结束-->
	<div class="clear"></div>
	<!--导航栏开始-->
	<div class="nav">
		<div class="inner">
			<ul class="">
				<li>
					<p onclick="functionone()">脸部护理</p>
				</li>
				<li>
					<a href="#" onclick="functionone()">身体护理</a>
				</li>
				<li>
					<a href="#" onclick="functionone()">防晒隔离</a>
				</li>
				<li>
					<a href="#" onclick="functionone()">明星产品</a>
				</li>
				<li>
					<a href="#">会员中心</a>
				</li>
				<li>
					<a href="#">特惠礼盒</a>
				</li>
				<li>
					<a href="#">品牌资讯</a>
				</li>
				<li>
					<a href="#">关于我们</a>
				</li>
			</ul>
			<div class="search">
				<input type="text" placeholder="搜索三体">
				<span></span>
			</div>
		</div>
	</div>
	<!--导航栏结束-->
	
	<!--广告开始-->
	<div class="banner">
	    <div class="inner">
	        <img th:src="@{/images/faceP1.jpg}" alt="">
	        <div class="face">
	            <p>ThreeBody</p>
	            <i>
	                ThreeBody产品蕴含大量的矿泉活性因子，<br>
	                帮助肌肤焕发光彩，重现年轻活力。
	            </i>
	        </div>
	        <div>
	            <h4><a th:href="@{index.html}">首页</a> ></h4>
	            <h4>我的购物车</h4>
	        </div>
	    </div>
	
	</div>
	<!--广告结束-->
	
	<!--我的购物车开始-->
	
	<div id="myContent" class="inner">
		
		<!--<div >
	        <table class="table table-bordered">
	            <caption><input class="checkedAll" type="checkbox">店铺名字</caption>
	            <tbody id="mytb">
	                <tr>
	                    <th class="col-md-1">✔</th>
	                    <th>商品详情</th>
	                    <th class="col-md-1">单价</th>
	                    <th class="col-md-2">商品数量</th>
	                    <th class="col-md-1">小计</th>
	                    <th class="col-md-1">操作</th>
	                </tr>
	                <tr>
					    <td><input class="checkBtn" type="checkbox"></td>
					    <td class="cartImg">
					        <img th:src="@{/images/face3.png}" alt="">
					        <div class="goodsinfo">商品详情</div>
					        <div class="goodsname">商品名称</div>
					        <div class="goodsbrand">商品品牌</div>
					    </td>
					    <td class="goodsprice">50</td>
					    <td class="addOrDel">
					        <input type="number" class="goodsnum" min="0" value="0">
					    </td>
					    <td class="total">0</td>
					    <td>删除</td>
	      			</tr>
	            </tbody>
	        </table>
	    </div>-->
		
		
		
		
	    <div id="clone1" style="display: none;">
	        <table class="table table-bordered">
	            <caption><input class="checkedAll" type="checkbox"></caption>
	            <tbody>
	                <tr>
	                    <th class="col-md-1">✔</th>
	                    <th>商品详情</th>
	                    <th class="col-md-1">单价</th>
	                    <th class="col-md-2">商品数量</th>
	                    <th class="col-md-1">小计</th>
	                    <th class="col-md-1">操作</th>
	                </tr> 
	            </tbody>
	        </table>
	      
	    </div>
	    
	     <div id="clone2" style="display: none;">
	      <tr id="clone3">
	        <td><input class="checkBtn" type="checkbox"></td>
	        <td class="cartImg">
	            <img th:src="@{/images/face3.png}" alt="">
	            <div class="goodsinfo">商品详情</div>
	            <div class="goodsname">商品名称</div>
	            <div class="goodsbrand">商品品牌</div>
	        </td>
	        <td class="goodsprice">50</td>
	        <td class="addOrDel">
	            <input type="number" class="goodsnum" min="0" value="0">
	        </td>
	        <td class="total">0</td>
	        <td>删除</td>
	      </tr>
	      </div>
	      
	</div>
	<!--我的购物车结束-->
	<div id="operation">
		<div class="del">删除</div>
		<div class="total">结算</div>
	</div>
	<!--页脚开始-->
	<div class="foot">
	    <div class="inner">
	        <ul>
	            <li>
	                <h1>脸部护理</h1>
	                <div>活泉系列-保湿</div>
	                <div>蓝源系列-抗老</div>
	                <div>奇迹系列-修护</div>
	                <div>滢澈皙白系列-美白</div>
	            </li>
	            <li>
	                <h1>身体护理</h1>
	                <div>凝乳丝滑系列-润肤</div>
	                <div>光感纤体系列-塑身</div>
	                <div>保湿香氛系列-香氛</div>
	                <div>阳光欢愉系列-清爽</div>
	            </li>
	            <li>
	                <h1>防晒隔离</h1>
	                <div>防晒</div>
	                <div>隔离</div>
	                <div>气垫</div>
	            </li>
	            <li>
	                <h1>品牌故事</h1>
	                <div>ThreeBody故事</div>
	                <div>逾60年致力于护肤 </div>
	                <div>ThreeBody灵魂成分 </div>
	                <div>ThreeBody的承诺 </div>
	            </li>
	            <li>
	                <h1>帮助中心</h1>
	                <div>订单查询</div>
	                <div>常见问题</div>
	                <div>联系我们</div>
	                <div>法律信息</div>
	                <div>网站地图</div>
	            </li>
	            <li class="footRight">
	                <h1>关注我们</h1>
	                <a th:href="@{https://weibo.com/u/6434760509}"> <span style="color: red"></span></a>
	                <span id="wechat" style="color: lawngreen"></span>
	                <span id="phone" style="color: deepskyblue"></span>
	                <section class="wechat">
	                    <p>了解详情请关注我们的官方微信号</p>
	                    <img th:src="@{/images/wechat.jpg}" alt="">
	                </section>
	                <section class="phone">
	                    <p>欢迎您致电我们的服务电话!</p>
	                    <p>&emsp;15363391819</p>
	                </section>
	            </li>
	        </ul>
	        <div class="clear"></div>
	        <div class="copyright">
	            <p> ©ThreeBody男妆版权所有:韩山师范学院计算机与信息工程学院“三体”小组，其中成员有丘彪、徐奕海、杨小辉、廖伟俊、何佳佳、崔灵涛。
	            </p>
	            <p>
	                抄袭必追究法律责任。欢迎探讨学习！
	            </p>
	        </div>
	    </div>
	</div>
	<!--页脚结束-->
	

	<script type="text/javascript">
		var currentUser = JSON.parse(sessionStorage.getItem("currentUser"));
		if(currentUser!=null){
			window.sessionStorage.setItem('userId',currentUser.userid);
		}
		if(window.sessionStorage.getItem('userId')==null){
			alert('对不起，您还没登录！');
			window.location.href='login.html';
		}
		/*进入购物车页面，获取当前用户的购物车数据*/
		
		
		console.log('userId='+currentUser.userid);
		$(function(){
			$.ajax({
			type:"GET",
			headers: {
					 'Access-Control-Allow-Origin': '*',  //此写法表明同意发送跨域请求
					},
			url:"http://192.168.1.112:8911/selectSCByUserid",
			dataType:"json",
			data:{"userId":window.sessionStorage.getItem('userId')},
			async:true,
			success:function(data){
				var goodsbrands=new Map();
				var datasList=data["datas"];
				console.log(data["datas"]);
				for(var i=0;i<data["datas"].length;i++){
					var bd=data["datas"][i].goodsbrand;
					if(!goodsbrands.has(bd)){
						goodsbrands.set(bd,bd);
					}
				}
				goodsbrands.forEach(function(value,key,map){
					var c1=$('#clone1').clone(true);
					c1.attr("id",value);
					c1.attr("style","display: block;");
					/*<input class="checkedAll" type="checkbox">*/
					c1.find('caption').append('<span style="'+"font-size:18px"+'">'+"店铺："+value+'</span>');
					c1.appendTo('#myContent');
					for(i in datasList){
						if(datasList[i].goodsbrand==value){
						var totalPrice=0;
						totalPrice=datasList[i].goodsprice*datasList[i].goodsnum;
						$('#'+value).find('tbody').append('<tr id="'+datasList[i].shopcartid+'">'+
					    '<td><input class="checkBtn" type="checkbox"></td>'+
					    '<td class="cartImg">'+
					        '<img src="/TBBrowser-0.0.1-SNAPSHOT/images/face3.png" alt="">'+
					        '<div class="goodsinfo">'+ datasList[i].goodsinfo+'</div>'+
					        '<div class="goodsname">'+ datasList[i].goodsname+'</div>'+
					        '<div class="goodsbrand">'+ datasList[i].goodsbrand+'</div>'+
					    '</td>'+
					    '<td class="goodsprice">'+ datasList[i].goodsprice+'</td>'+
					    '<td class="addOrDel">'+
					        '<input type="number" onblur='+"saveInfo(this)"+' onchange='+"changeInfo(this)"+' class="goodsnum" min="0" value='+datasList[i].goodsnum +'>'+
					    '</td>'+
					    '<td class="total">'+totalPrice+'</td>'+
					    '<td><a value='+datasList[i].goodsid+' onclick='+"deleteGoods(this)"+' >删除</a></td>'+
	      			'</tr>'	
	      			);
					}
				}
				})
				
			
			},
			error:function(){
				console.log("执行selectSCByUserid错误");
			}
			});
			
			});
		
		
		
		
		/*$.ajax({
			type:"POST",
			headers: {
					 'Access-Control-Allow-Origin': '*',  //此写法表明同意发送跨域请求
					 'Content-Type': 'application/json; charset=UTF-8'
					},
			url:"http://192.168.1.112:8911/insertShoppingCarSelective",
			dataType:"json",
			data:JSON.stringify({"userid":1,"goodsid":4,"goodsnum":200}),
			async:false,
			success:function(data){
				console.log(data.size()+"你好");
			},
			error:function(){
				console.log("执行insertShoppingCarSelective错误");
			}
		});
		*/
		
		/*购物车中删除单条商品记录*/
		function deleteGoods(good){
			/*var goodsid=good.getAttribute("value");*/
			var scid=good.parentElement.parentElement.id;
			
			//在页面上删除单个商品
			var tbody=good.parentElement.parentElement.parentElement;
			var tr=good.parentElement.parentElement;
			tr.remove();
			if(tbody.childElementCount==1){
				tbody.parentElement.parentElement.remove();
			}
			
			
			//在购物车表删除商品
			$.ajax({
			type:"DELETE",
			headers: {
					 'Access-Control-Allow-Origin': '*',  //此写法表明同意发送跨域请求
					 'Content-Type': 'application/json; charset=UTF-8'
					},
			url:"http://192.168.1.112:8911/deleteShoppingCar",
			dataType:"json",
			data:JSON.stringify([{"shopcartid":scid}]),
			async:false,
			success:function(data){
				console.log(data['message']);
			},
			error:function(){	
				console.log("执行deleteShoppingCar错误");
			}
			});
		}
		
		//改变小计
		function changeInfo(myinfo){
			console.log(myinfo.value);
			console.log(myinfo.innerHTML);
			var goodsPriceEle=myinfo.parentElement.previousElementSibling;
			var totalPriceEle=myinfo.parentElement.nextElementSibling;
			totalPriceEle.innerText=parseInt(myinfo.value)*parseInt(goodsPriceEle.innerHTML);
		}
		
		//修改购物车中某一个商品的数量
		function saveInfo(myinfo){
			$.ajax({
			type:"PUT",
			headers: {
					 'Access-Control-Allow-Origin': '*',  //此写法表明同意发送跨域请求
					 'Content-Type': 'application/json; charset=UTF-8'
					},
			url:"http://192.168.1.112:8911/updateSCWithGoodsNum",
			dataType:"json",
			data:JSON.stringify({"shopcartid":myinfo.parentElement.parentElement.id,"goodsnum":myinfo.value}),
			async:false,
			success:function(data){
				console.log(data['message']);
			},
			error:function(){
				console.log("执行updateSCWithGoodsNum错误");
			}
		});
		
		}
		
		
		
	    //单选
	    var $checkBtn = $('.checkBtn');
	    var $checkBtns= $('#myContent')

	 
	    $checkBtn.on().click(function () {
	        if(this.checked){
	            $(this).parent().nextAll("td").find('.number').attr("disabled","disabled");
	        }else{
	            $(this).parent().nextAll("td").find('.number').removeAttr("disabled");
	        }
	    });
	    //全选特效开始
	    var $checkedAll =$(".checkedAll");
	    $checkedAll.on().click(function(){
	        if(this.checked == true){
	            $(this).parent().nextAll("tbody").find('.checkBtn').each(function(){
	            	this.checked=true;
	            });
	            $(this).parent().nextAll("tbody").find('.number').attr("disabled","disabled");
	        }else if(this.checked == false){
	            $(this).parent().nextAll("tbody").find('.checkBtn').each(function(){
	            	this.checked=false;
	            });
	            $(this).parent().nextAll("tbody").find('.number').removeAttr("disabled");
	        }
	    });
	
	
	    //全选特效结束
	
	    //
	    var $number = $('.number');
	    $number.on().click(function () {
	        var unitPrice = $(this).parent().prev().html();
	        var number = $(this).val();
	        var result = Number(unitPrice)*Number(number);
	        $(this).parent().next().html(result);
	    });
	    
	    
	    //给删除按钮绑定点击事件
	    var $del = $(".del");
	    $del.on().click(function(){
	    	 var $checkBtns= $('#myContent');
	    	 $checkBtns.find('.checkBtn').length;
	    	 var $checkBtns1= $('#myContent').find('.checkBtn');
	    	 var a=new Array();
	   		 for(var i=1;i<$checkBtns1.length;i++){
	   		 	if($checkBtns.find('.checkBtn')[i].checked){
	   		 		var tb= $checkBtns.find('.checkBtn').eq(i).parent().parent().parent();
	   		 		a.push($checkBtns.find('.checkBtn').eq(i).parent().parent());
	   		 	}
	   		 }
	   		 //Array c存放 将要在购物车中删除的商品列表  存放Map类型数据
	   		 var c=new Array();
	   		for(i in a){
	   			var d=new Map();
	   			d["shopcartid"]=a[i].attr('id');
	   			c.push(d);
	   		 	a[i].remove();
	   		}
	   		 var b=new Array();
	   		 for(var i=2;i<$checkBtns.children('div').length;i++){
	   		 	if($checkBtns.children('div').eq(i).find('tbody').find('tr').length==1){
	   		 		b.push($checkBtns.children('div').eq(i));
	   		 	}
	   		 }
	   		 for(i in b){
	   		 	b[i].remove();
	   		 	
	   		 }
	   		//在购物车表删除多个商品
			$.ajax({
			type:"DELETE",
			headers: {
					 'Access-Control-Allow-Origin': '*',  //此写法表明同意发送跨域请求
					 'Content-Type': 'application/json; charset=UTF-8'
					},
			url:"http://192.168.1.112:8911/deleteShoppingCar",
			dataType:"json",
			data:JSON.stringify(c),
			async:false,
			success:function(data){
				console.log(data['message']);
			},
			error:function(){	
				console.log("执行deleteShoppingCar错误");
			}
			});
	    })
	    
	    
	    
	    
	    //给`按钮绑定点击事件
	     var $total = $(".total");
	     $total.on().click(function(){
	     	var $checkBtns= $('#myContent');
	     	//找到该页面上所有的单选框
	    	var btns= $checkBtns.find('.checkBtn');
	    	//查找给选中的单选框
	    	//创建一个商品对象
	    	var goodsList=new Array();
	    	
	    	for(var i=1;i<btns.length;i++){
	    		if(btns[i].checked){
	    			(function(i){
	    			var good=new Map();
	    			good["goodsid"]=$('.checkBtn').eq(i).parent().parent().find('a').attr('value');
	    			good["goodsprice"]=$('.checkBtn').eq(i).parent().parent().find('.goodsprice').html();
					good["goodsnum"]=$('.checkBtn').eq(i).parent().parent().find('.goodsnum').attr('value');
					good["total"]=$('.checkBtn').eq(i).parent().parent().find('.total').html();
					good["goodsinfo"]=$('.checkBtn').eq(i).parent().parent().find('.goodsinfo').html();
					good["goodsname"]=$('.checkBtn').eq(i).parent().parent().find('.goodsname').html();
					good["goodsbrand"]=$('.checkBtn').eq(i).parent().parent().find('.goodsbrand').html();
					good["goodsphotocode"]=$('.checkBtn').eq(i).parent().parent().find('img').attr('src');
					goodsList.push(good);
	    			})(i);
	    		}
	    	}
	    	
	    	if(goodsList.length==0){
	    		alert("请你先选择需要购买的商品");
	    		return;
	    		
	    	}
	    	
	    	
	    	//sessionStorage存数组或者对象 需要JSON序列化
	    	window.sessionStorage.setItem('goodsList',JSON.stringify(goodsList));
	    	
	    	//sessionStorage拿数组或者对象 需要反序列化
	    	console.log(JSON.parse(window.sessionStorage.getItem('goodsList')));
	    	window.location.href="payments.html";
	    });
	   
	    	
	     	 
		/*页面跳转*/
		function functionone(){
			$.ajax({
				type: "post",
				url: "http://192.168.1.102:8903/selectgoodstype",
				dataType:"json",
				headers: {
					'Access-Control-Allow-Origin': '*'
				},
				data: {
					"gtypeId": 1,
					"pageSize": 9,
					"pageNum":1
				},
				async: false,
				success: function(data){
					window.location.href="productList.html";
				},
			});
		}

	
	   // <!--页脚“关注我们”模块特效开始-->
	    $('#wechat').mouseenter(function () {
	        $('.wechat').css({display:"block"})
	    }).mouseleave(function () {
	        $('.wechat').css({display:"none"})
	    });
	    $('#phone').mouseenter(function () {
	        $('.phone').css({display:"block"})
	    }).mouseleave(function () {
	        $('.phone').css({display:"none"})
	    })
	    //<!--页脚“关注我们”模块特效结束-->
	</script>

	<!--用户头像-->
	<script type="text/javascript" th:inline="javascript">
		var currentUser = JSON.parse(sessionStorage.getItem("currentUser"));
		console.log(currentUser);
		if(currentUser != null){
			var useraccount = currentUser.useraccount;
			var usericon = currentUser.usericon;
			if(usericon != null){
				$("#li-login").css({display: "none"});
				$("#li-useraccount").css({display: "none"});
				$("#li-usericon").css({display: "block"});
				$("#li-usericon").attr("src",usericon);
			}else if(useraccount != null){
				$("#li-login").css({display: "none"});
				$("#li-usericon").css({display: "none"});
				$("#li-useraccount").css({display: "block"});
				$("#useraccount").text(useraccount);
			}
		}else{
			$("#li-login").css({display: "block"});
			$("#li-usericon").css({display: "none"});
			$("#li-useraccount").css({display: "none"});
		}
		</script>
	<!--js结束-->
	</body>
	</html>